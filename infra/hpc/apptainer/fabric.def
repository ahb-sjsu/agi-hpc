Bootstrap: docker
From: ubuntu:22.04

%labels
    subsystem EventFabric
    role MessagingUCX

%post
    apt-get update && \
    apt-get install -y python3 python3-pip python3-dev \
                       build-essential git curl \
                       libzmq3-dev protobuf-compiler \
                       libucx-dev ucx-utils && \
    python3 -m pip install --upgrade pip

    pip install pyzmq
    pip install -e /opt/agi-hpc

%files
    ../../../src /opt/agi-hpc/src
    ../../../pyproject.toml /opt/agi-hpc/

%environment
    export PYTHONPATH=/opt/agi-hpc/src

%runscript
    exec python3 -m agi_hpc.services.event_fabric
