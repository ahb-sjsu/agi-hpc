Bootstrap: docker
From: ubuntu:22.04

%labels
    subsystem Environment
    role VirtualEnvConnector

%post
    apt-get update && \
    apt-get install -y python3 python3-pip python3-dev \
                       build-essential git curl \
                       libzmq3-dev protobuf-compiler \
                       ffmpeg libsm6 libxext6 && \
    python3 -m pip install --upgrade pip

    pip install -e /opt/agi-hpc

%files
    ../../../src /opt/agi-hpc/src
    ../../../pyproject.toml /opt/agi-hpc/

%environment
    export PYTHONPATH=/opt/agi-hpc/src
    export ENV_SERVICE_PORT=50060

%runscript
    exec python3 -m agi_hpc.environment.env_server
